e1.ann3 %>% filter(pp==11, rr=="dispersed", st=="early", tb==0)
e1.ann3 %>% filter(pp==11, rr=="dispersed", st=="early", tb==1)
e1.ann3 %>% filter(pp==11, rr=="dispersed", st=="early", tb==2)
e1.ann3 %>% filter(pp==11, rr=="dispersed", st=="early", tb==3)
summary(dd)
nrow(dd)
e1.raw <- readRDS("001-00-e1-data.RDS")
e1.sub <- e1.raw %>% select(pp, rr, tb, ix, tl, fl, fr)
e1.ann <- e1.sub %>%
# remove samples that did not look at a tree
filter(fl>0) %>% select(-fl) %>%
# identify consecutive dupes for removal
mutate(dupe = !(is.na(tl != lag(tl)) | tl != lag(tl))) %>%
# remove dupes
filter(dupe==FALSE) %>%
# annotate with revisit
group_by(pp, rr, tb) %>% mutate(isrv = duplicated(tl)) %>% ungroup() %>%
# annotate with max fruit
group_by(pp, rr, tb) %>% mutate(maxf = max(fr)) %>% ungroup() %>%
# remove samples in the tenth fruit
filter(fr !=10)
# make sure each trial has an entry for the zeroth fruit
merge_me = expand_grid(pp = sort(unique(e1.ann$pp)), rr = sort(unique(e1.ann$rr)), tb = sort(unique(e1.ann$tb)), fr = 0)
e1.ann2 <- full_join(e1.ann, merge_me) %>% arrange(pp, rr, tb, fr)
# redo isrv such that the zeroth fruit has FALSE for isrv instead of NA
e1.ann2 <- e1.ann2 %>% replace_na(list(isrv=FALSE))
# redo maxf to replace NA with whatever the max was for that trial
e1.ann2 <- e1.ann2 %>% group_by(pp,rr,tb) %>% mutate(maxf=max(maxf, na.rm=TRUE)) %>% ungroup()
# remove trials with maxf less than 10
e1.ann3 <- e1.ann2 %>% filter(maxf == 10)
# add stage
e1.ann3 <- e1.ann3 %>% mutate(st=ifelse(tb<=5, "early", "late"))
# aggregate such that there is a row for each fruit visited (including the zeroth but not the tenth)
# saying how many (sum) revisits there were while searching for that fruit
e1.agg1 <- e1.ann3 %>%
group_by(pp, rr, st, tb, fr) %>%
summarise(nrev=sum(isrv)) %>%
ungroup()
# aggregate over trials to give mean sum revisits at the relevant fruit for each stage
e1.agg2 <- e1.agg1 %>%
group_by(pp, rr, st, fr) %>%
summarise(murev=mean(nrev)) %>%
ungroup()
dd = e1.agg2
dd <- dd %>% mutate(pp=as_factor(pp), rr=as_factor(rr), st=as_factor(st), fr=as_factor(fr))
# anova
library(ez)
options(contrasts=c("contr.sum","contr.poly"))
dda = ezANOVA(data=dd, dv=murev, wid=pp, within=c(rr, st, fr), type=3)
knitr::kable(dda$ANOVA)
knitr::kable(dda$`Sphericity Corrections`)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path='e1_figures/')
knitr::opts_chunk$set(fig.width=7, fig.height=5)
options(dplyr.summarise.inform=F)
library(tidyverse)
library(ez)
library(gt)
e1 <- readRDS("001-00-e1-data.RDS")
e1_revisits_df <-
e1 %>%
transmute(
pp = as_factor(pp),
trial = as.numeric(tb), # ranges 1 to 10
resources = rr,
stage = ifelse(trial<=5,"early","late"),
basket = fr,
sample = ix,
tree = tl)
e1_revisits_df <- e1_revisits_df %>%
mutate(revisit = as.numeric(duplicated(tree))) %>%
mutate(
# "is_a" to remind us that the raw data are binary yes/no
# for whether the current visit is a revisit or not
is_a_revisit = as.logical(revisit)
) %>%
# number of revisits can't be greater than zero for the 10th fruit
# because we stop recording data as soon as they get to 10
# so we remove those values because they must have no variance
# and it would distort the analysis to treat those zeros as meaningful.
filter(
basket < 10
) %>%
# basket+1 because the data were recorded such that this
# tally is zero until they get a fruit but we want to say
# that they had a certain number of revisits while they
# were searching for the first fruit, not while they
# had zero fruit in their basket
mutate(
basket = basket +1
) %>%
# set factors
mutate(
trial = as_factor(trial),
stage = as_factor(stage),
tree = as_factor(tree),
basket = as_factor(basket),
resources = as_factor(resources)
)
gt(subset(e1_revisits_df, pp==1&trial==1&resources=="patchy"))
e1_revisits_df_agg1 <-
e1_revisits_df %>%
group_by(pp,trial,stage,resources,basket) %>%
summarise(sum_of_revisits = sum(is_a_revisit))
e1_revisits_df_agg2 <-
expand.grid(
basket=1:10,
trial=c(1:10,1:10),
pp=unique(e1_revisits_df_agg1$pp)
) %>% # is 8400
mutate(
stage=ifelse(trial<=5,"early","late")
) %>%
bind_cols(
resources=as_factor(rep(c("dispersed","patchy"),each=10,times=420))
) %>%
select(
pp,trial,stage,resources,basket
) %>%
mutate(
trial=as_factor(trial),
stage=as_factor(stage),
resources=as_factor(resources),
basket=as_factor(basket)
) %>%
as_tibble() %>%
left_join(
y = e1_revisits_df_agg1,
by = c("pp", "trial", "stage", "resources", "basket")
) %>%
replace_na(list(sum_of_revisits=0))
e1_nrevisits_grand_PARTICIPANT_MEANS <-
e1_revisits_df_agg2 %>%
group_by(pp, resources, stage, basket) %>%
summarise(meanrevisits=mean(sum_of_revisits))
options(contrasts=c("contr.sum","contr.poly"))
e1_nrevisits_grand_ANOVA<-
ezANOVA(data=e1_nrevisits_grand_PARTICIPANT_MEANS,
dv=meanrevisits,
wid=pp,
within=c(resources,stage,basket),
type=3)
e1_nrevisits_grand_ANOVA_TABLE <-
e1_nrevisits_grand_ANOVA$ANOVA %>%
select(-ges) %>%
gt() %>%
tab_header(
title="Number of revisits",
subtitle = "ANOVA table"
) %>%
fmt_number(
columns = c("F"),
rows=everything(),
decimals=2
)  %>%
fmt_number(
columns = c("p"),
rows=everything(),
decimals=3
) %>%
cols_align(
columns=`p<.05`,
align="center"
)
gtsave(e1_nrevisits_grand_ANOVA_TABLE, "e1_tables/e1_nrevisits_grand_ANOVA.png")
e1_nrevisits_grand_ANOVA_TABLE
e1_nrevisits_grand_ANOVA_TABLE
rm(list=ls())
e1.raw <- readRDS("001-00-e1-data.RDS")
e1.sub <- e1.raw %>% select(pp, rr, tb, ix, tl, fl, fr)
e1.ann <- e1.sub %>%
# remove samples that did not look at a tree
filter(fl>0) %>% select(-fl) %>%
# identify consecutive dupes for removal
mutate(dupe = !(is.na(tl != lag(tl)) | tl != lag(tl))) %>%
# remove dupes
filter(dupe==FALSE) %>%
# annotate with revisit
group_by(pp, rr, tb) %>% mutate(isrv = duplicated(tl)) %>% ungroup() %>%
# annotate with max fruit
group_by(pp, rr, tb) %>% mutate(maxf = max(fr)) %>% ungroup() %>%
# remove samples in the tenth fruit
filter(fr !=10)
# make sure each trial has an entry for the zeroth fruit
merge_me = expand_grid(pp = sort(unique(e1.ann$pp)), rr = sort(unique(e1.ann$rr)), tb = sort(unique(e1.ann$tb)), fr = 0)
e1.ann2 <- full_join(e1.ann, merge_me) %>% arrange(pp, rr, tb, fr)
# redo isrv such that the zeroth fruit has FALSE for isrv instead of NA
e1.ann2 <- e1.ann2 %>% replace_na(list(isrv=FALSE))
# redo maxf to replace NA with whatever the max was for that trial
e1.ann2 <- e1.ann2 %>% group_by(pp,rr,tb) %>% mutate(maxf=max(maxf, na.rm=TRUE)) %>% ungroup()
# remove trials with maxf less than 10
e1.ann3 <- e1.ann2 %>% filter(maxf == 10)
# add stage
e1.ann3 <- e1.ann3 %>% mutate(st=ifelse(tb<=5, "early", "late"))
# aggregate such that there is a row for each fruit visited (including the zeroth but not the tenth)
# saying how many (sum) revisits there were while searching for that fruit
e1.agg1 <- e1.ann3 %>%
group_by(pp, rr, st, tb, fr) %>%
summarise(nrev=sum(isrv)) %>%
ungroup()
# aggregate over trials to give mean sum revisits at the relevant fruit for each stage
e1.agg2 <- e1.agg1 %>%
group_by(pp, rr, st, fr) %>%
summarise(murev=mean(nrev)) %>%
ungroup()
dd = e1.agg2
dd <- dd %>% mutate(pp=as_factor(pp), rr=as_factor(rr), st=as_factor(st), fr=as_factor(fr))
options(contrasts=c("contr.sum","contr.poly"))
e1_nrevisits_grand_ANOVA <-
ezANOVA(data=dd, dv=murev, wid=pp, within=c(rr, st, fr), type=3)
e1_nrevisits_grand_ANOVA_TABLE <-
e1_nrevisits_grand_ANOVA$ANOVA %>%
select(-ges) %>%
gt() %>%
tab_header(
title="Number of revisits",
subtitle = "ANOVA table"
) %>%
fmt_number(
columns = c("F"),
rows=everything(),
decimals=2
)  %>%
fmt_number(
columns = c("p"),
rows=everything(),
decimals=3
) %>%
cols_align(
columns=`p<.05`,
align="center"
)
gtsave(e1_nrevisits_grand_ANOVA_TABLE, "e1_tables/e1_nrevisits_grand_ANOVA.png")
e1_nrevisits_grand_ANOVA_TABLE
knitr::include_graphics("e1_tables/e1_nrevisits_grand_ANOVA.png")
dd
View(dd)
# we want one value from each participant for early and one value from each participant for late, = stage means for the body text
stagemeansPerParticipant <-
e1_revisits_df %>%
ungroup() %>%
select(pp, trial, stage, is_a_revisit) %>%
# get count for each trial
group_by(pp, trial, stage) %>%
summarise(count_revisits_for_trial=sum(is_a_revisit)) %>%
# aggregate trial counts to get a single value for each stage from each participant
group_by(pp,stage) %>%
summarise(mean_revisits=mean(count_revisits_for_trial))
View(e1.ann3)
e1.ann3
# stage means
stage_means <- e1.ann3 %>%
group_by(pp, st, tb) %>%
summarise(count=sum(isrv))
stage_means
View(stage_means)
# stage means
stage_means <- e1.ann3 %>%
group_by(pp, st, tb) %>%
summarise(count=mean(isrv)) %>%
# stage means
stage_means <- e1.ann3 %>%
group_by(pp, st, tb) %>%
summarise(mu=mean(isrv)) %>%
# stage means
stage_means <- e1.ann3 %>%
group_by(pp, st, tb) %>%
summarise(mu=mean(isrv))
# stage means
stage_means <- e1.ann3 %>%
group_by(pp, st, tb) %>%
summarise(mu=mean(isrv))
# stage means
stage_means <- e1.ann3 %>%
group_by(pp, st, tb, fr) %>%
summarise(mu=mean(isrv))
# stage means
stage_means <- e1.ann3 %>%
group_by(pp, st, tb, fr) %>%
summarise(mu=mean(isrv)) %>%
group_by(st, pp) %>%
sumamrise(mu=mean(mu))
# stage means
stage_means <- e1.ann3 %>%
group_by(pp, st, tb, fr) %>%
summarise(mu=mean(isrv)) %>%
group_by(st, pp) %>%
summarise(mu=mean(mu))
# stage means
stage_means <- e1.ann3 %>%
group_by(pp, st, tb, fr) %>%
summarise(mu=mean(isrv)) %>%
group_by(st, pp) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu))
# stage means
stage_means <- e1.ann3 %>%
group_by(pp, st, tb, fr) %>%
summarise(count=sum(isrv)) %>%
group_by(st, pp) %>%
summarise(mu=mean(count)) %>%
summarise(mu=mean(mu))
e1.agg2
View(e1.agg2)
stage_means = e1.agg2 %>%
group_by(pp,st) %>%
mu=mean(murev)
stage_means = e1.agg2 %>%
group_by(pp,st) %>%
summarise(mu=mean(murev))
stage_means = dd %>%
group_by(pp,st) %>%
summarise(mu=mean(murev))
stage_means = dd %>%
group_by(st, pp) %>%
summarise(mu=mean(murev))
stage_means = dd %>%
group_by(st, pp) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu))
stage_means = dd %>%
group_by(st, pp, rr, fr) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu))
stage_means
stage_means = dd %>%
group_by(st, pp, rr, fr) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu))
stage_means
stage_means = dd %>%
group_by(st, pp, rr, fr) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu))
stage_means
dd %>%
group_by(st, pp, rr, fr) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu))
stage_means = dd %>%
group_by(st, pp, rr, fr) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu), sd=sd(mu))
stage_means
stage_means = dd %>%
group_by(st, pp, rr, fr) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(muu=mean(mu), sd=sd(muu))
stage_means
stage_means = dd %>%
group_by(st, pp, rr, fr) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(muu=mean(mu), sd=sd(mu))
stage_means
fruit_means = dd %>%
group_by(fr, pp, rr, tb) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(muu=mean(mu), sd=sd(mu))
dd
fruit_means = dd %>%
group_by(fr, pp, rr, st) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(muu=mean(mu), sd=sd(mu))
fruit_means
fruit_meansfilter(fr==0)
fruit_means %>% filter(fr==0)
stage_means
stage_means %>% kable()
stage_means %>% kable(digits=2)
stage_means = dd %>%
group_by(st, pp, rr, fr) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(mean=mean(mu), sd=sd(mu))
stage_means %>% kable(digits=2)
stage_means
round(stage_means,2)
print(stage_means)
print(stage_means, digits=2)
summarise(muu=round(mean(mu),2), sd=round(sd(mu),2)
stage_means = dd %>%
stage_means = dd %>%
group_by(st, pp, rr, fr) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(mean=mean(mu), sd=sd(mu))
stage_means %>% mutate(mean=round(mean,2))
stage_means = dd %>%
group_by(st, pp, rr, fr) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(mean=mean(mu), sd=sd(mu))
stage_means %>% mutate(mean=round(mean,2))
stage_means %>% mutate(mean=round(mean,2), sd=round(sd,2))
fruit_means %>% mutate(mean=round(mean,2), sd=round(sd,2))
fruit_means = dd %>%
group_by(fr, pp, rr, st) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(muu=mean(mu), sd=sd(mu))
fruit_means = dd %>%
group_by(fr, pp, rr, st) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(mean=mean(mu), sd=sd(mu))
fruit_means %>% mutate(mean=round(mean,2), sd=round(sd,2))
fruit_means = dd %>%
group_by(fr, pp, rr, st) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(mean=mean(mu), sd=sd(mu)) %>%
mutate(mean=round(mean,2), sd=round(sd,2))
fruit_means
fruit_means %>% filter(fr==0)
fruit_means %>% filter(fr==9)
fruit_means %>% filter(fr==0)
fruit_means %>% filter(fr==9)
fruit_means %>% filter(fr%in%c(0,9))
fruit_means = dd %>%
group_by(fr, pp, rr, st) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(mean=mean(mu), sd=sd(mu)) %>%
mutate(mean=round(mean,2), sd=round(sd,2))
fruit_means
stage_means = dd %>%
group_by(st, pp, rr, fr) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(mean=mean(mu), sd=sd(mu))
stage_means %>% mutate(mean=round(mean,2), sd=round(sd,2))
stage_means = dd %>%
group_by(st, pp, rr, fr) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(mean=mean(mu), sd=sd(mu)) %>%
mutate(mean=round(mean,2), sd=round(sd,2))
fruit_means = dd %>%
group_by(fr, pp, rr, st) %>%
summarise(mu=mean(murev)) %>%
summarise(mu=mean(mu)) %>%
summarise(mu=mean(mu)) %>%
summarise(mean=mean(mu), sd=sd(mu)) %>%
mutate(mean=round(mean,2), sd=round(sd,2))
fruit_means
fruit_means[1,2]
fruit_means[1,3]
`r fruit_means[1,2]` +/- `r fruit_means[1,3]`.
dd
data_for_plot <-
dd %>% group_by(pp, rr, st) %>%
summarise(mean_revisits=mean(murev))
data_for_plot
data_for_plot <-
dd %>% group_by(pp, rr, st) %>%
summarise(mean_revisits=mean(murev))
pd <- position_dodge(0.1)
e1_nrevisits_grand_PLOT2 <-
ggplot(data=data_for_plot, aes(x=st, y=mean_revisits, group=rr, pch=rr, fill=rr))+
theme_bw()+
theme(aspect.ratio = 1, panel.grid=element_blank(), axis.title.y=element_text(angle=0,vjust=0.5,hjust=0.5))+
scale_fill_manual(name="Resource\ndistribution",values=c("white", "black")) +
scale_shape_manual(name="Resource\ndistribution",values=c(24,19)) +
stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width=0.1, position=pd) +
stat_summary(fun = mean, geom = "line", position=pd) +
stat_summary(fun = mean, geom = "point", size=4, position=pd)+
ggtitle("Number of Revisits")+
ylab("Number\nof\nRevisits")+
xlab("Trial")+
scale_x_discrete(labels=c("early\ntrials 1 to 5", "late\ntrials 6 to 10"))#+labs(caption="Significant stage effect, no interaction effect")
e1_nrevisits_grand_PLOT2
data_for_plot
data_for_plot <-
dd %>% group_by(rr, st, pp) %>%
summarise(mean_revisits=mean(murev))
data_for_plot
data_for_plot %>% summarise(m=mean(mean_revisits))
data_for_plot %>% summarise(m=mean(mean_revisits)) %>% summarise(m=mean(m))
data_for_plot <-
dd %>% group_by(st, rr, pp) %>%
summarise(mean_revisits=mean(murev))
data_for_plot %>% summarise(m=mean(mean_revisits)) %>% summarise(m=mean(m))
e1_nrevisits_grand_PLOT
source("~/.active-rstudio-document", echo=TRUE)
data_for_plot
View(data_for_plot)
source("~/.active-rstudio-document", echo=TRUE)
source("~/.active-rstudio-document", echo=TRUE)
e1_nrevisits_grand_ANOVA
