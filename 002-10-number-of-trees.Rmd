# Number of trees

Experiment 2

```{r, include=F}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.path='e2_figures/')
knitr::opts_chunk$set(fig.width=7, fig.height=5)
knitr::opts_chunk$set(out.width="33%")
options(dplyr.summarise.inform=F)
```

Load the libraries.

```{r, include=F}
library(tidyverse)
library(ez)
library(gt)
```

This line reads in the dataset that results from collating the results files for each participant.

```{r, echo=TRUE}
e2 <- readRDS("fgms_e2_allsubs.rds")
```
 
This renames the raw data but doesn't do any operations on it.

```{r raw, echo=TRUE}
# this tibble is one row for each tree visited saying whether it was a revisit or not
e2_ntrees <-
  e2 %>%
  transmute(
    pp           = as_factor(participant),
    trial        = trial_number,
    resources    = factor(R, levels=c(".pat","dis"), labels=c("clumped", "random")),
    fading       = factor(V, levels=c(".fade","nofade"), labels=c("fade", "no_fade")),
    stage        = as_factor(ifelse(trial<=10, "early", "late")),
    progress     = factor(trial),
    index        = index,
    tree         = tile)
```

## Aggregation 1: 

The data has a row for each tree visited. We want a trial level count of the number of trees visited. 

```{r, echo=TRUE}
TRIAL_SUMS <- 
  e2_ntrees %>% 
  group_by(pp, resources, stage, fading, trial, progress) %>% 
  summarise(trees=n())
```
                                
## Aggregation 2:

```{r, echo=TRUE}
PARTICIPANT_MEANS <-
  TRIAL_SUMS %>% 
  group_by(pp, resources, stage, fading) %>% 
  summarise(mean_trees_per_stage = mean(trees))
```

## Aggregation 3:

```{r, echo=TRUE}
CONDITION_MEANS <-
  PARTICIPANT_MEANS %>% 
  group_by(resources, stage, fading) %>% 
  summarise(mean = mean(mean_trees_per_stage), sd = sd(mean_trees_per_stage)) 

RESOURCES_FADING_MEANS <-
  PARTICIPANT_MEANS %>% 
  group_by(resources, fading) %>% 
  summarise(mean = mean(mean_trees_per_stage), sd = sd(mean_trees_per_stage))

RESOURCES_STAGE_MEANS <-
  PARTICIPANT_MEANS %>% 
  group_by(resources, stage) %>% 
  summarise(mean = mean(mean_trees_per_stage), sd = sd(mean_trees_per_stage))
  
STAGE_FADING_MEANS <-
  PARTICIPANT_MEANS %>% 
  group_by(stage, fading) %>% 
  summarise(mean = mean(mean_trees_per_stage), sd = sd(mean_trees_per_stage))
  
RESOURCES_MEANS <-
  PARTICIPANT_MEANS %>% 
  group_by(resources) %>% 
    summarise(mean = mean(mean_trees_per_stage), sd = sd(mean_trees_per_stage))

STAGE_MEANS <-
  PARTICIPANT_MEANS %>% 
  group_by(stage) %>% 
    summarise(mean = mean(mean_trees_per_stage), sd = sd(mean_trees_per_stage))

FADING_MEANS <-
  PARTICIPANT_MEANS %>% 
  group_by(fading) %>% 
    summarise(mean = mean(mean_trees_per_stage), sd = sd(mean_trees_per_stage))
```

## Descriptives

```{r, echo=TRUE}
CONDITION_MEANS %>% gt(groupname_col = "resources") %>% fmt_number(columns = c("mean","sd"), decimals=2) %>% tab_header("Number of trees") %>%  gtsave("e2_tables/ntrees_condition_means.png")
```

```{r, echo=TRUE}
RESOURCES_FADING_MEANS %>% gt(groupname_col = "resources") %>% fmt_number(columns = c("mean","sd"), decimals=2) %>% tab_header("Number of trees") %>% gtsave("e2_tables/ntrees_resources_fading_means.png")
```

```{r, echo=TRUE}
RESOURCES_STAGE_MEANS %>% gt(groupname_col = "resources") %>% fmt_number(columns = c("mean","sd"), decimals=2) %>% tab_header("Number of trees") %>% gtsave("e2_tables/ntrees_resources_stage_means.png")
```

```{r, echo=TRUE}
STAGE_FADING_MEANS %>% gt(groupname_col = "stage") %>% fmt_number(columns = c("mean","sd"), decimals=2) %>% tab_header("Number of trees") %>% gtsave("e2_tables/ntrees_stage_fading_means.png")
```

```{r, echo=TRUE}
RESOURCES_MEANS %>% gt() %>% fmt_number(columns = c("mean","sd"), decimals=2) %>%  tab_header("Number of trees") %>% gtsave("e2_tables/ntrees_resources_means.png")
```

```{r, echo=TRUE}
STAGE_MEANS %>% gt() %>% fmt_number(columns = c("mean","sd"), decimals=2) %>%  tab_header("Number of trees") %>% gtsave("e2_tables/ntrees_stage_means.png")
```

```{r, echo=TRUE}
FADING_MEANS %>% gt() %>% fmt_number(columns = c("mean","sd"), decimals=2) %>%  tab_header("Number of trees") %>% gtsave("e2_tables/ntrees_fading_means.png")
```

## ANOVA with resources and stage within-subjects and fading between-subjects

```{r, echo=T}
options(contrasts=c("contr.sum","contr.poly"))
ez_ntrees <- ezANOVA(data=PARTICIPANT_MEANS,
               dv=mean_trees_per_stage,
               wid=pp,
               within=c(resources,stage),
               between=fading,
               type=3)
```

```{r, echo=FALSE}
ez_ntrees$ANOVA %>% 
  select(-ges) %>% 
  gt() %>% 
  tab_header(
    title="Number of trees",
    subtitle = "ANOVA table"
  ) %>% 
  fmt_number(
    columns = c("F"),
    rows=everything(),
    decimals=2
  )  %>% 
  fmt_number(
    columns = c("p"),
    rows=everything(),
    decimals=3
  ) %>% 
  cols_align(
    columns=`p<.05`,
    align="c"
  ) %>% 
  gtsave("e2_tables/ntrees_anova-number-of-trees.png")
```

## Plots

```{r, echo=F, message=F, out.width="50%"}
# Ten points along the x axis, each participant contributes one point per cell
ggplot(
  data=TRIAL_SUMS, 
  aes(x=progress, y=trees, group=resources, pch=resources, fill=resources)
) +
  facet_wrap(~fading)+
  theme_bw()+
  theme(aspect.ratio = 1, panel.grid=element_blank())+
  scale_fill_manual(values=c("white", "black")) +
  scale_shape_manual(values=c(24,19)) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width=0.2, position=position_dodge(0.25)) +
  stat_summary(fun = mean, geom = "line", position=position_dodge(0.25)) + 
  stat_summary(fun = mean, geom = "point", size=3, position=position_dodge(0.25)) +
  geom_jitter(pch=1, width=0.1, alpha=0.4) 
ggsave("e2_plots/progress-number-of-trees.png")
```

```{r, echo=F, message=F, out.width="50%"}
# Two points along the x axis, each participant contributes one point per cell
ggplot(
  data=PARTICIPANT_MEANS, 
  aes(x=stage, y=mean_trees_per_stage, group=resources, pch=resources, fill=resources)
) +
  facet_wrap(~fading)+
  theme_bw()+
  theme(aspect.ratio = 1, panel.grid=element_blank())+
  scale_fill_manual(values=c("white", "black")) +
  scale_shape_manual(values=c(24,19)) +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width=0.2, position=position_dodge(0.25)) +
  stat_summary(fun = mean, geom = "line", position=position_dodge(0.25)) + 
  stat_summary(fun = mean, geom = "point", size=3, position=position_dodge(0.25))
ggsave("e2_plots/stage-number-of-trees.png")
```

